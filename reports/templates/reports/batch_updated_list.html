{% extends 'base.html' %}
{% load static %}
{% load center_filters %}

{% block dashboard %}
<div class="container p-4 bg-warning-subtle">
  <div class="my-2">
    <a href="{% url 'staff_dashboard' %}" class="btn btn-primary">Go Back</a>
  </div>
    <div class="row shuffle bg-warning-subtle m-2 rounded">
        <form method="get" class="rounded p-2 pb-3 d-flex gap-2 align-items-end">
            <div class="">
                <label for="latest_date" class="form-label">Type: </label>
                <select class="form-select" id="type-option" style="width: fit-content;" name="type" required onchange="this.form.submit()">
                    {% for type in type_choices %}
                    <option value="{{ type.0 }}" {% if selected_type == type.0 %} selected {% endif %} >{{ type.1 }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="">
                <label for="latest_date" class="form-label">To: {{ filter_date|date:'d M Y' }}</label>
                <input type="date" name="date" id="date" value="{{filter_date|date:'Y-m-d'}}"
                    class="form-control" required onchange="this.form.submit()">
            </div>
            <button style="height: fit-content;" class="px-2 btn btn-warning" type="submit">Search</button>
        </form>

    </div>
  {% if batches_by_class %}
    {% for cls, batches in batches_by_class.items %}
      <h3 class="my-3">{{cls}}</h3>
      <div class="row shuffle bg-warning-subtle" data-masonry='{"percentPosition": true }' id="batches">
        {% for batch in batches %}
        <div class="col-sm-6 col-md-4 col-lg-3 category shuffle-item shuffle-item--visible mb-4">
          <div class="card">
            <ul class="list-group">
              <li class="list-group-item bg-dark text-white list-group border-dark"> {{ batch.batch }}</li>
              <li style="position: relative;" class="d-flex justify-content-between align-items-center">
                <a target="_blank" href="{% url 'attendance_batch' batch.batch.class_name.id batch.batch.id  %}?type={{selected_type}}&date={{filter_date|date:'Y-m-d'}}" class="d-flex justify-content-between align-items-center w-100 text-decoration-none text-dark">
                    <div class="bg-success-subtle rounded m-1 p-1 d-flex justify-content-center align-items-center" style="width: 45%;">
                        {{ batch.attendance.present }}
                    </div>
                    <div class="bg-danger-subtle rounded m-1 p-1 d-flex justify-content-center align-items-center" style="width: 45%;">
                        {{ batch.attendance.absent }}
                    </div>
                </a>
              </li>
              
              <li style="position: relative;" class="d-flex justify-content-between align-items-center">
                <a target="_blank" href="{% url 'homework_batch' batch.batch.class_name.id batch.batch.id  %}?date={{filter_date|date:'Y-m-d'}}" class="d-flex justify-content-between align-items-center w-100 text-decoration-none text-dark">
                     
                    <div class="bg-danger-subtle rounded m-1 p-1 d-flex justify-content-center align-items-center" style="width: 30%;">
                        {{ batch.homework.pending }}
                    </div>
                    <div class="bg-primary-subtle rounded m-1 p-1 d-flex justify-content-center align-items-center" style="width: 30%;">
                        {{ batch.homework.partial }}
                    </div>
                    <div class="bg-success-subtle rounded m-1 p-1 d-flex justify-content-center align-items-center" style="width: 30%;">
                        {{ batch.homework.completed }}
                    </div>
                </a>

              </li>
            </ul>
          </div>
        </div>
        {% endfor %}
      </div>
    {% endfor %}
  {% endif %}
</div>


<script src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js"
  integrity="sha384-GNFwBvfVxBkLMJpYMOABq3c+d3KnQxudP/mGPkzpZSTYykLBNsZEnG2D9G/X/+7D" crossorigin="anonymous" async>
  </script>

{% endblock dashboard %}